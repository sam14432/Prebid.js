<!-- Implements relevantSasCmd() that should be used *instead* of sas.cmd.push() -->
<script>
(function () {
   window.sas = sas || {};
   sas.cmd = sas.cmd || [];

	/** Global settings object that will be used by Relevant's Prebid version (and here) */
	window.RELEVANT_POSTBID_CONFIG = {
		prebidAborted: false, // Set to true to skip prebid completely
		loadRelevantClientLib: true, // Set to false if relevant-client-lib.js is loaded directly on the page instead
		events: {
			/** Callback when prebid is intialized and the Smart cmds are ready to be called */
			onInitPrebidDone: function() {
				prebidInitialized = true;
				flushSasOps();
			}
		},
	};
	/** How long time to wait *without* getting the onInitPrebidDone() callback above - until we skip prebid and calls Smart without prebid */
	var TIMEOUT_MS = 1000;

	/** If we're not using prebid, just run all Smart calls as usual */
	if(RELEVANT_POSTBID_CONFIG.prebidAborted) {
		window.relevantSasCmd = function(fn) {
			sas.cmd.push(fn);
		}
		return;
	}
	var pendingSasOps = []; ///< Smart cmds that are queued until prebid is initialized *or* until we've timed out
	var prebidInitialized = false; ///< Will be set to true by the onInitPrebidDone() callback above

	/** Flush pending Smart cmds */	
	function flushSasOps() {
		for(var i = 0; i < pendingSasOps.length; i++) {
			sas.cmd.push(pendingSasOps[i]);
		}
		pendingSasOps = null;
	}

	/** Replacement for sas.cmd.push(), will delay calling that function until prebid is initalized (or we've timed out) */	
	window.relevantSasCmd = function(fn) {
		if(!prebidInitialized || RELEVANT_POSTBID_CONFIG.prebidAborted) {
			sas.cmd.push(fn)
		} else {
			pendingSasOps.push(fn);
		}
	}
	
	/** Will abort attempt to use prebid and run all pending Smart cmds if Prebid has not been initialized after TIMEOUT_MS */	
	setTimeout(function() {
		if(!prebidInitialized) {
			RELEVANT_POSTBID_CONFIG.prebidAborted = true;
			flushSasOps();
		}
	}, TIMEOUT_MS);
})()
</script>
<script async src='//apps-cdn.relevant-digital.com/tags/my_prebid_config.js'></script>

